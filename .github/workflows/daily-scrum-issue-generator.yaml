---
name: Weekly Team Sync
on:
  schedule:
    - cron: "*/5 * * * *"
    - timezone: 'Asia/Seoul'
jobs:
  create_issue:
    name: Create team sync issue
    runs-on: ubuntu-latest
    permissions:
      issues: write
      contents: write
      pull-requests: write
      repository-projects: write
    steps:
      - name: Get current date
        id: date
        run: echo "::set-output name=date::$(date +'%Y-%m-%d')"
      - name: Create team sync issue
        run: |
          if [[ $CLOSE_PREVIOUS == true ]]; then
            previous_issue_number=$(gh issue list \
              --label "$LABELS" \
              --json number \
              --jq '.[0].number')
            if [[ -n $previous_issue_number ]]; then
              gh issue close "$previous_issue_number"
              gh issue unpin "$previous_issue_number"
            fi
          fi
          new_issue_url=$(gh issue create \
            â€”title "$TITLE" \
            â€”assignee "$ASSIGNEES" \
            â€”label "$LABELS" \
            â€”body "$BODY")
          if [[ $PINNED == true ]]; then
            gh issue pin "$new_issue_url"
          fi
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          GH_REPO: ${{ github.repository }}
          TITLE: Daily Scrum (${{ steps.date.outputs.date }})
          ASSIGNEES: su-giana
          LABELS: daily-scrum
          BODY: |
            # ìŠ¤í¬ëŸ¼ ğŸ‰ / Wrap-up ğŸŒ¯ ì¤‘ íƒ 1
            ìŠ¤í¬ëŸ¼ í…œí”Œë¦¿
            1. ì–´ì œ í•œ ì¼ ğŸŒ™
            -
            2. ì˜¤ëŠ˜ í•  ì¼ ğŸ”¥
            -
            3. ê³µìœ í•  ì´ìŠˆ ğŸ™Œ
            -
          PINNED: false
          CLOSE_PREVIOUS: false

